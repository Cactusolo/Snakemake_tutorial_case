<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Reproductive research with Snakemake and Git</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #008800; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #AA22FF; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #008800; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #008800; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #008800 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #008800; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #008800; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #008800; font-weight: bold } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #AA22FF; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #AA22FF; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #AA22FF; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #AA22FF } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #AA22FF; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #00BB00; font-weight: bold } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BB4444 } /* Literal.String */
.listingblock .pygments .tok-na { color: #BB4444 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #AA22FF } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #00A000 } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #B8860B } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BB4444 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BB4444 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BB4444 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BB4444 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BB4444; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BB4444 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BB4444 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BB4444 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #B8860B } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #AA22FF } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #00A000 } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #B8860B } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #B8860B } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #B8860B } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #B8860B } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article">
<div id="header">
<h1>Reproductive research with Snakemake and Git</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial you are going to learn the basic concepts of building workflows with Snakemake. You are also going to learn how to use Git to control your code and Bitbucket to keep it always safe of accidental deletions. To achieve this goal, we are going to replicate part of the RNA-seq workflow published by <a href="https://www.nature.com/articles/nprot.2016.095">Pertea et al, 2016</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preparing_the_environment_and_adding_our_first_file_to_git_version_control">Preparing the environment and adding our first file to Git version control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To begin, let&#8217;s create a directory called <em>my_rnaseq_exp</em> and move to it. This directory name is expected for some of the scripts published with the paper. Therefore, let&#8217;s keep this name.</p>
</div>
<div class="paragraph">
<p>The following command lines are going to create the new directory and move to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>mkdir my_rnaseq_exp
<span class="tok-nb">cd</span> my_rnaseq_exp</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run Snakemake, we need to create a file called <em>Snakefile</em>, that will contain the rules to be executed. Let&#8217;s take advantage of this step to put in practice some concepts of Git and learn how to connect our code with a Bitbucket repository. Therefore, before creating any file, let&#8217;s create a Git online repository and connect it to our local directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Access your Bitbucket account now. If you haven&#8217;t one account yet, create one at <a href="https://bitbucket.org/">bitbucket.org</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the left side of the screen, click on the plus sign <code>(+)</code>, then on 'Repository'. Create a name for both your project and your repository. For now, let&#8217;s skip the creation of a README file by selecting <strong>'No'</strong> in the option <code>'include a README'</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Make sure to select the box called 'Private repository'! It will insure that your files are not visible on internet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After creating the repository, you will see a page with instructions on how to connect the online repository to your local directory. Before executing these commands, we need to initiate Git on our directory. You will need to run the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can connect with our Bitbucket repository. Execute the first line of <strong>step2</strong> shown in the Bitbucket webpage. It should look like the line below, but should contain the information of your user and repository names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git remote add origin https://Wendell_Pereira@bitbucket.org/Wendell_Pereira/psc_workshop.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>The repository is now connected to our local directory, but we do not have any files under version control yet. Let&#8217;s create a file to insert the Snakemake rules and add it to version control by Git. In the command lines below, <code>touch</code> creates a new, empty file called Snakefile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>touch Snakefile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, lets add it to Git:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git add Snakefile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a text editor, like nano or VI, let&#8217;s insert a short comment in the file. I suggest a short description as a title or any other information of your choice. The goal here is just to make changes in the content of the file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since we want Snakemake to understand it as a comment, we need to start each line with '#'.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, I am going to add this header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># May 15th, PSC Bioinformatics Workshop - Snakemake Workflows</span>
<span class="tok-c1"># Wendell Pereira (wendellpereira@ulf.edu)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s tell Git to record the changes, and create our first commit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git commit -m <span class="tok-s2">&quot;My first commit!&quot;</span> Snakefile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Git stores all your commits in a hidden folder insider your current directory. You can see the folder using <code>ls -lha</code> in the terminal. In general, this folder is protected from accidental deletions. However, they can happen and it is always preferable to synchronize our files and commits with an online repository, to keep them safe. Since we already connected our local directory with the online version on Bitbucket, we can just transfer the information using the <code>git push</code> command, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git push origin master</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since your repository is private, Bitbucket will ask your password in the terminal.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We don&#8217;t need to go deep in the details of how Git controls the branches, and into the meaning of the nomenclatures like origin and master. For now, we just need to know that <code>git push</code> is sending the information from our local machine to the online repository. In the same way, <code>git pull</code> will download the information of the online directory to the local one.</p>
</div>
<div class="paragraph">
<p>For more information, you can check the Git manual <a href="https://git-scm.com/">here</a>. Also, UF Research Computing team frequently offers training on Git and Github (which works similar to Bitbucket). There are also multiple sources, including many blog posts and videos, on how to use Git on the internet.</p>
</div>
<div class="paragraph">
<p>Now, you can see that the Snakefile is in your online repository. To see how <code>git pull</code> works, let&#8217;s add a README file in our online repository. Click on <code>&#8230;&#8203;</code> on the upper-right corner of the Bitbucket webpage, then on <code>add a file</code>. Type 'README' as the file name and type a description of your choice. Finally, click on commit.</p>
</div>
<div class="listingblock">
<div class="title">For example:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>This repository contains the contents of the <span class="tok-s2">&quot;PSC Bioinformatics Workshop - Snakemake Workflows&quot;</span>, May 15th.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we have a file that only exists in the online repository. To download it for your local repository, use the follow command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git pull origin master</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we should see a README file in our local repository. This is a very simple example, but you can use Git to synchronize files on multiple computers, i.e. on HiperGator and on your local computer. Moreover, multiple people can work in the same repository, though the process of synchronizing the changes is a little more complex than what was shown here.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Be aware of conflicts between versions in the online and local repositories. For example, if you altered a file in the online repo and also changed it in the local version, Git will not be able to synchronize it easily. Instead, it will offer you an option of merging the different versions, which may cause unintended changes. Try to always keep the versions updated, synchronizing the files before you work on them on a different machine or repository.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_constructing_the_pipeline">Constructing the pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have our Snakefile, let&#8217;s start to create our pipeline by adding rules that are going to execute the necessary tasks to replicate part of the results described on <a href="https://www.nature.com/articles/nprot.2016.095">Pertea et al, 2016</a>.</p>
</div>
<div class="paragraph">
<p>But first, we need to download the input data. The list of files available to download can be found <a href="ftp://ftp.ccb.jhu.edu/pub/RNAseq_protocol">here</a>.</p>
</div>
<div class="sect2">
<h3 id="_download_of_the_input_data">Download of the input data</h3>
<div class="paragraph">
<p>The following steps are going to download and prepare the datasets described on <a href="https://www.nature.com/articles/nprot.2016.095">Pertea et al, 2016</a> to be used. Note that we first create a 'developmental Slurm session' to avoid executing commands in the login servers of HiperGator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>module load ufrc
srundev --time<span class="tok-o">=</span><span class="tok-m">2</span>:00:00 --ntasks<span class="tok-o">=</span><span class="tok-m">1</span> --cpus-per-task<span class="tok-o">=</span><span class="tok-m">1</span> --mem<span class="tok-o">=</span>2gb

<span class="tok-c1"># Download</span>
wget ftp://ftp.ccb.jhu.edu/pub/RNAseq_protocol/chrX_data.tar.gz
tar xvzf chrX_data.tar.gz

<span class="tok-c1"># Removes the compresssed file</span>
rm chrX_data.tar.gz</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In general, we do not include the download of inputs in the workflow. Instead, the pipeline is usually constructed to access the data in the current, or in a specific directory.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_our_first_rule_mapping_the_reads">Adding our first rule - mapping the reads</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Initially, let&#8217;s keep the code as simple as possible. Then, we will start to modify it to make it more flexible. Below is the code of a rule that will execute the mapping of the reads.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">rule</span> <span class="tok-n">mapping_opt1</span><span class="tok-p">:</span>
    <span class="tok-nb">input</span><span class="tok-p">:</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188044_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188044_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188104_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188104_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188234_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188234_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188245_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188245_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188257_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188257_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188273_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188273_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188337_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188337_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188383_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188383_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188401_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188401_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188428_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188428_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188454_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188454_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR204916_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR204916_chrX_2.fastq.gz&quot;</span>
    <span class="tok-n">output</span><span class="tok-p">:</span>
        <span class="tok-s2">&quot;ERR188044_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188104_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188234_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188245_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188257_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188273_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188337_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188383_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188401_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188428_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188454_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR204916_chrX.sam&quot;</span>
    <span class="tok-n">shell</span><span class="tok-p">:</span>
        <span class="tok-sd">&quot;&quot;&quot;</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188044_chrX_1.fastq.gz -2 chrX_data/samples/ERR188044_chrX_2.fastq.gz -S ERR188044_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188104_chrX_1.fastq.gz -2 chrX_data/samples/ERR188104_chrX_2.fastq.gz -S ERR188104_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188234_chrX_1.fastq.gz -2 chrX_data/samples/ERR188234_chrX_2.fastq.gz -S ERR188234_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188245_chrX_1.fastq.gz -2 chrX_data/samples/ERR188245_chrX_2.fastq.gz -S ERR188245_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188257_chrX_1.fastq.gz -2 chrX_data/samples/ERR188257_chrX_2.fastq.gz -S ERR188257_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188273_chrX_1.fastq.gz -2 chrX_data/samples/ERR188273_chrX_2.fastq.gz -S ERR188273_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188337_chrX_1.fastq.gz -2 chrX_data/samples/ERR188337_chrX_2.fastq.gz -S ERR188337_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188383_chrX_1.fastq.gz -2 chrX_data/samples/ERR188383_chrX_2.fastq.gz -S ERR188383_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188401_chrX_1.fastq.gz -2 chrX_data/samples/ERR188401_chrX_2.fastq.gz -S ERR188401_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188428_chrX_1.fastq.gz -2 chrX_data/samples/ERR188428_chrX_2.fastq.gz -S ERR188428_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR188454_chrX_1.fastq.gz -2 chrX_data/samples/ERR188454_chrX_2.fastq.gz -S ERR188454_chrX.sam</span>
<span class="tok-sd">        hisat2 -p 6 --upto 200000 --dta -x chrX_data/indexes/chrX_tran -1 chrX_data/samples/ERR204916_chrX_1.fastq.gz -2 chrX_data/samples/ERR204916_chrX_2.fastq.gz -S ERR204916_chrX.sam</span>
<span class="tok-sd">        &quot;&quot;&quot;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A common error is to forget the comma between the input or output items. Snakemake will return an error that the syntax is wrong.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Copy the above commands to your Snakefile. Now, to visualize what Snakemake will execute, we can run a 'dry-run' (using option <code>-n</code>). This will show what will be executed, without actually running the task. We will also add the option <code>-p</code> to print the shell code.</p>
</div>
<div class="paragraph">
<p>If you are running it on HiperGator, you need to load the Snakemake module first. If you are running in your computer, skip the command to load the module.</p>
</div>
<div class="listingblock">
<div class="title">For HiperGator only!</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>module load snakemake/5.17.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1">#snakemake -n -p mapping_opt1</span>
snakemake -np mapping_opt1</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is possible to execute the command without adding the name of the rule (<code>snakemake -np</code>). When we do that, Snakemake will try to execute the first rule in the Snakefile. Since we only have one, the final result will be the same. Later, we will take advantage of this aspect to guarantee the execution of all rules in the pipeline.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some points to consider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the mapping rule, we still write all file names and parameters in the rule itself. Therefore, this rule is not flexible. That means you CANNOT use it with different input files.</p>
</li>
<li>
<p>The code is structured by the insertion of indentations. Snakemake relies on this structure and the code will fail if it is not respected.</p>
</li>
<li>
<p>The code in the shell block is equivalent to executing line by line in a terminal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As we can see, it is a long command and there is no advantage of using this structure instead of a shell script yet. For that, we need to start to take advantage of the Snakemake functions. Let&#8217;s modify the code to a structure more similar to what we would do in real life.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">rule</span> <span class="tok-n">mapping_opt2</span><span class="tok-p">:</span>
    <span class="tok-nb">input</span><span class="tok-p">:</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188044_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188044_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188104_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188104_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188234_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188234_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188245_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188245_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188257_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188257_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188273_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188273_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188337_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188337_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188383_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188383_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188401_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188401_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188428_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188428_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188454_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR188454_chrX_2.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR204916_chrX_1.fastq.gz&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;chrX_data/samples/ERR204916_chrX_2.fastq.gz&quot;</span>
    <span class="tok-n">params</span><span class="tok-p">:</span>
        <span class="tok-n">threads</span><span class="tok-o">=</span><span class="tok-mi">6</span><span class="tok-p">,</span>
        <span class="tok-n">n_of_reads</span><span class="tok-o">=</span><span class="tok-mi">200000</span><span class="tok-p">,</span>
        <span class="tok-n">genome_index</span><span class="tok-o">=</span><span class="tok-s2">&quot;chrX_data/indexes/chrX_tran&quot;</span>
    <span class="tok-n">output</span><span class="tok-p">:</span>
        <span class="tok-s2">&quot;ERR188044_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188104_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188234_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188245_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188257_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188273_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188337_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188383_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188401_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188428_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR188454_chrX.sam&quot;</span><span class="tok-p">,</span>
        <span class="tok-s2">&quot;ERR204916_chrX.sam&quot;</span>
    <span class="tok-n">shell</span><span class="tok-p">:</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[0]} -2 {input[1]} -S {output[0]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[2]} -2 {input[3]} -S {output[1]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[4]} -2 {input[5]} -S {output[2]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[6]} -2 {input[7]} -S {output[3]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[8]} -2 {input[9]} -S {output[4]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[10]} -2 {input[11]} -S {output[5]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[12]} -2 {input[13]} -S {output[6]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[14]} -2 {input[15]} -S {output[7]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[15]} -2 {input[17]} -S {output[8]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[16]} -2 {input[19]} -S {output[9]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[17]} -2 {input[21]} -S {output[10]};&quot;</span>
        <span class="tok-s2">&quot;hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {input[18]} -2 {input[23]} -S {output[11]};&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Basically, what we did was use the variables <code>input</code>, <code>output</code> and <code>params</code> as substitutes for the real file names or parameter values. Nonetheless, we still need to add all this information in the rule itself, which makes it still not flexible. To verify how the shell commands are going to be executed, let&#8217;s execute a new dry-run.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake -np mapping_opt2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have seen how to use these variables as part of our code, let&#8217;s go through the main step to make it flexible: using a configuration file. In the next section, we will create flexible rules that could be used in a real-life workflow.</p>
</div>
<div class="paragraph">
<p>However, before that, let&#8217;s save the changes in our code using git commit. No need to synchronize it with the online repository yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git commit -m <span class="tok-s2">&quot;Add two options of rules to execute the mapping of the reads in the reference genome.&quot;</span> Snakefile</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_flexibility_in_the_workflow_through_using_a_configuration_file">Flexibility in the workflow through using a configuration file</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A configuration file can be write in <a href="https://www.json.org/json-en.html">JSON</a> or <a href="https://yaml.org/">YAML</a>. We will use YAML because, in my opinion, it produces a file that&#8217;s easier to read.</p>
</div>
<div class="paragraph">
<p>To begin, let&#8217;s create a new file and add it to Git.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>touch config.yaml
git add config.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we need to define the connection between "Snakefile" and "config.yaml". It is very simple to do. We just need to add the line of code below in the beginning of the Snakefile (right after the comments).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>configfile: <span class="tok-s2">&quot;config.yaml&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>configfile:</code> command tells Snakemake to access the parameters from the configuration file.</p>
</div>
<div class="paragraph">
<p>For the next step, we will use the <code>expand()</code> function to help us to generate the input and output file names. In addition, all parameters are going to be read from the config.yaml file.</p>
</div>
<div class="paragraph">
<p>In the Snakefile, add the following command lines. The code seems complicated at the first. However, it is quite simple once you understand how the information from the configuration file is used. We will go though all aspects and <strong>don&#8217;t be shy about using the Zoom chat if you have any questions!</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">rule</span> <span class="tok-n">mapping</span><span class="tok-p">:</span>
    <span class="tok-nb">input</span><span class="tok-p">:</span>
        <span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;{dir}/{samples}_{inputs_sufix}&quot;</span><span class="tok-p">,</span>
        <span class="tok-nb">dir</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs_directory&quot;</span><span class="tok-p">],</span>
        <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">],</span>
        <span class="tok-n">inputs_sufix</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs_sufix&quot;</span><span class="tok-p">]),</span>
    <span class="tok-n">params</span><span class="tok-p">:</span>
        <span class="tok-n">genome_index</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;params&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;genome_index&quot;</span><span class="tok-p">],</span>
        <span class="tok-n">threads</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;params&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;threads&quot;</span><span class="tok-p">],</span>
        <span class="tok-n">n_of_reads</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;params&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;n_of_reads&quot;</span><span class="tok-p">],</span>
        <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">],</span>
        <span class="tok-n">inputs_sufix</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs_sufix&quot;</span><span class="tok-p">],</span>
        <span class="tok-nb">dir</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs_directory&quot;</span><span class="tok-p">],</span>
    <span class="tok-n">output</span><span class="tok-p">:</span>
        <span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;mapping_out/{samples}.sam&quot;</span><span class="tok-p">,</span> <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">])</span>
    <span class="tok-n">shell</span><span class="tok-p">:</span>
        <span class="tok-sd">&quot;&quot;&quot;</span>
<span class="tok-sd">        for file in {params.samples};</span>
<span class="tok-sd">        do</span>

<span class="tok-sd">            hisat2 -p {params.threads} --upto {params.n_of_reads} --dta -x {params.genome_index} -1 {params.dir}/${{file}}_{params.inputs_sufix[0]} -2 {params.dir}/${{file}}_{params.inputs_sufix[1]} -S mapping_out/${{file}}.sam</span>

<span class="tok-sd">        done</span>
<span class="tok-sd">        &quot;&quot;&quot;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The use of a for loop in the shell block of code allows us to work with different numbers of samples. Since the same operation needs to be executed for each sample, and the for loop will process all of them, at the end, we have one output file for each sample.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We directed the output files to the directory <code>mapping_out</code>. However, we did not create this directory yet. Snakemake will generated it automatically!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, let&#8217;s add the information of our samples in the configuration file. Copy and paste the following code in the config.yaml file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">mapping</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">params</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">genome_index</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">chrX_data/indexes/chrX_tran</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">threads</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">6</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">n_of_reads</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">200000</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">inputs</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-p tok-p-Indicator">[</span>
    <span class="tok-s">&quot;ERR188044_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188104_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188234_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188245_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188257_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188273_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188337_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188383_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188401_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188428_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR188454_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
    <span class="tok-s">&quot;ERR204916_chrX&quot;</span><span class="tok-p tok-p-Indicator">,</span>
        <span class="tok-p tok-p-Indicator">]</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">inputs_sufix</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-p tok-p-Indicator">[</span><span class="tok-s">&quot;1.fastq.gz&quot;</span><span class="tok-p tok-p-Indicator">,</span> <span class="tok-s">&quot;2.fastq.gz&quot;</span><span class="tok-p tok-p-Indicator">]</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">inputs_directory</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;chrX_data/samples&quot;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Similar to Snakefile, the configuration file also accepts comments starting with "#".
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The main point here is that <code>config</code> stores the information present in the config.yaml. Therefore, all we need to do is use <code>["name"]</code> to point to the variables in the 'config.yaml' file. If there are multiple nested levels, we need to use multiple brackets. For example, <code>["mapping"]["params"]["threads"]</code> recovers the number <code>6</code>, since it is stored in <code>mapping: params: threads:</code> entrance of the 'config.yaml' file.</p>
</div>
<div class="paragraph">
<p>To help us to understand how the rule works, lets execute a dry-run using <code>-n</code>. We also want to visualize the shell commands. For that, we can add <code>-p</code> (<code>-np</code> to combine both).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake -np mapping</code></pre>
</div>
</div>
<div class="paragraph">
<p>If everything worked well, we can see that the function <code>expand()</code> generates the same inputs and outputs as listed in the previous rules. However, now it will work for any number of samples that are listed in the configuration file. Since we also used a for loop, the shell part of the code is also independent of the number of samples. Therefore, we can consider this rule as a flexible one, since it can deal with any number of samples that have the same characteristics of the samples we are using.</p>
</div>
<div class="paragraph">
<p>So far, we have the rule we intend to execute, but we did not run any of them. For now, you will trust that all rules produce the same results (You can run them by yourself later to prove it, if you wish) and will keep only the option 3 in our Snakefile.</p>
</div>
<div class="paragraph">
<p>Delete the previous rules from your Snakefile, add the rule mapping and save it. Also, use <code>git commit</code> to track this change and <code>git push</code> to syncronize to Bitbucket. Let&#8217;s check in our online repository to see what the code looks like and how all the commits are registered&#8201;&#8212;&#8201;even the one we did not synchronize before.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git commit -m <span class="tok-s2">&quot;Substitutes the previous mapping rules for one improved version&quot;</span> Snakefile
git commit -m <span class="tok-s2">&quot;Adds the parameters for the mapping rule&quot;</span> config.yaml

git push origin master</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s execute the code. Since we want to use multiple cores, we need to start a new developmental session on HiperGator. If you are running it on your computer, you can skip this step and run only the snakemake command.</p>
</div>
<div class="listingblock">
<div class="title">For HiperGator only!</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-c1"># exit the previous session and starts a new one</span>
<span class="tok-nb">exit</span>
<span class="tok-n">srundev</span> <span class="tok-o">--</span><span class="tok-n">time</span><span class="tok-o">=</span><span class="tok-mi">2</span><span class="tok-p">:</span><span class="tok-mo">00</span><span class="tok-p">:</span><span class="tok-mo">00</span> <span class="tok-o">--</span><span class="tok-n">ntasks</span><span class="tok-o">=</span><span class="tok-mi">1</span> <span class="tok-o">--</span><span class="tok-n">cpus</span><span class="tok-o">-</span><span class="tok-n">per</span><span class="tok-o">-</span><span class="tok-n">task</span><span class="tok-o">=</span><span class="tok-mi">6</span> <span class="tok-o">--</span><span class="tok-n">mem</span><span class="tok-o">=</span><span class="tok-mi">10</span><span class="tok-n">gb</span>

<span class="tok-c1"># Load snakemake and</span>
<span class="tok-n">module</span> <span class="tok-n">load</span> <span class="tok-n">snakemake</span><span class="tok-o">/</span><span class="tok-mf">5.17</span><span class="tok-o">.</span><span class="tok-mi">0</span>
<span class="tok-n">module</span> <span class="tok-n">load</span> <span class="tok-n">hisat2</span><span class="tok-o">/</span><span class="tok-mf">2.2</span><span class="tok-o">.</span><span class="tok-mi">0</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake -p mapping</code></pre>
</div>
</div>
<div class="paragraph">
<p>While running the mapping rule above, we did not inform snakemake about the number of available cores. It will recognize how many cores we have and use as many as the rule requests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the rule request more cores than we have available, snakemake will reduce the number of cores of the rule to make it compatible. If we have more cores that we need, snakemake may run multiple jobs of a pipeline at the same time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are on HiperGator, it will run, but you will notice an error message. That is because Snakemake uses python3 and Hisat loads python2, generating a conflict.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Be aware of dependencies conflicts in HiperGator! Sometimes, we need to load a module right before the rule that depends on it, then remove it and load other modules that following rules depend on, or reload the modules that were broken by the conflict.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Most of the time, we do not want to run our jobs in the developmental session of HiperGator. Instead, we need to submit a job to Slurm scheduler (using a sbatch script, for example). It is possible to do that using Snakemake too, as we will learn in the next section.</p>
</div>
<div class="listingblock">
<div class="title">An example of a sbatch script</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-ch">#!/bin/sh</span>
<span class="tok-c1">#SBATCH --job-name=prank                    # Job name</span>
<span class="tok-c1">#SBATCH --mail-type=ALL                     # Mail events (NONE, BEGIN, END, FAIL, ALL)</span>
<span class="tok-c1">#SBATCH --mail-user=wendellpereira@ufl.edu  # Where to send mail</span>
<span class="tok-c1">#SBATCH --nodes=1                           # Use one node</span>
<span class="tok-c1">#SBATCH --ntasks=1                          # Run a single task</span>
<span class="tok-c1">#SBATCH --cpus-per-task=1                   # Number of CPU cores per task</span>
<span class="tok-c1">#SBATCH --mem-per-cpu=10gb                  # Memory per processor</span>
<span class="tok-c1">#SBATCH --time=96:00:00                     # Time limit hrs:min:sec</span>
<span class="tok-c1">#SBATCH --qos=kirst                         # qos</span>
<span class="tok-c1">#SBATCH --output=prank_%A-%a.out            # Standard output and error log</span>

<span class="tok-c1"># Load required modules</span>
module load cnspipeline/20170827
module load maffilter/1.3.0
module load R/3.6
module load bedtools/2.27.1
module load perl/5.24.1
module load prank/170427
module load phast/1.5

<span class="tok-c1">#Command lines</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_snakemake_in_a_slurm_environment">Running Snakemake in a Slurm environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To submit jobs in Slurm using Snakemake, we need to incorporate the <code>--cluster</code> option during the execution. This will store the parameters that Slurm requires. If you are used to running sbatch scripts, <code>--cluster</code> is the place where you need to insert the information that goes in the header of an sbatch script.</p>
</div>
<div class="paragraph">
<p>Similarly to what we do when running sbatch scripts, we also need to load the modules that are going to be executed during the Slurm job. The easiest way to do it is by adding some Python code in the Snakefile that will tell Snakemake to load the modules before executing the rules.</p>
</div>
<div class="paragraph">
<p>If you are running it on your computer, you can skip this step.</p>
</div>
<div class="paragraph">
<p>If you are running it on HiperGator, add these lines right before the first rule.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">run_in_slurm_env</span> <span class="tok-o">=</span> <span class="tok-bp">True</span>
<span class="tok-k">if</span> <span class="tok-n">run_in_slurm_env</span> <span class="tok-o">==</span> <span class="tok-bp">True</span><span class="tok-p">:</span>
    <span class="tok-n">shell</span><span class="tok-o">.</span><span class="tok-n">prefix</span><span class="tok-p">(</span><span class="tok-s2">&quot;module load hisat2/2.2.0; module load stringtie/2.0.4; module load samtools/1.3.1; module load stringtie/2.0.4; module load gffread/0.9.8c&quot;</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this way, Snakemake will be able to use these parameters to submit your job as a shell script. Here we are going to execute only one rule. However, in real life projects, you can submit your whole workflow and Snakemake will manage the jobs submission for you.</p>
</div>
<div class="paragraph">
<p>It is easier to understand using an example. Let&#8217;s check the command to execute the mapping rule, described above, as a slurm job.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake -np -j <span class="tok-m">10</span> --cluster <span class="tok-s2">&quot;sbatch -A kirst --mem=4gb -t 02:00:00 -c 6 -o mapping_%j.out -e mapping_%j.err --mail-user wendellpereira@ufl.edu --mail-type ALL&quot;</span> mapping</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s understand the parameters in this command line:</p>
</div>
<div class="paragraph">
<p>The following are <strong>Snakemake parameters</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-n</code> Runs a dry-run (not execute the commands)</p>
</li>
<li>
<p><code>-p</code> Print the shell commands</p>
</li>
<li>
<p><code>-j</code> Controls the maximum number of jobs that Snakemake can have submitted at a time. That is useful so you can guarantee that you are not taking all resources from your qos.</p>
</li>
<li>
<p><code>--cluster</code> This is the submission command that should be used for the scheduler (in our case, Slurm). Note that command flags which normally are put in batch scripts are put here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The parameters below are <strong>Slurm options</strong> and must be given for the <code>--cluster</code> option.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-A</code> Account name (or the qos that contains the resources you can access)</p>
</li>
<li>
<p><code>--mem</code> Amount of memory</p>
</li>
<li>
<p><code>-t</code> Requested time</p>
</li>
<li>
<p><code>-c</code> Number of cpus per task</p>
</li>
<li>
<p><code>-o</code> Name of the file that will receive the output messages.</p>
</li>
<li>
<p><code>-e</code> Name of the file that will receive the error messages.</p>
</li>
<li>
<p><code>--mail-user</code> Email that will receive the status messages of the job</p>
</li>
<li>
<p><code>--mail-type</code> What type of message Slurm should send to the email. ALL tells Slurm to send messages of events (job started, job completed, job failed, etc.)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To see all list of Slurm parameters, check: <a href="https://slurm.schedmd.com/sbatch.html" class="bare">https://slurm.schedmd.com/sbatch.html</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While you can execute this command as described above, creating a new configuration file to store the values of Slurm parameters will add flexibility to your workflow. We will do it in the next section.</p>
</div>
<div class="sect2">
<h3 id="_creating_a_cluster_configuration_file">Creating a cluster configuration file</h3>
<div class="paragraph">
<p>Let&#8217;s create a new file called 'cluster.yaml' and also add it to Git version control.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>touch cluster.yaml
git add cluster.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most of the time, Slurm jobs will all contain the same basic information, such as the name of the qos, email, amount of memory, number of cores, etc. Therefore, we can create some default parameters that will be used in all our Slurm jobs.</p>
</div>
<div class="paragraph">
<p>Copy the code below to your 'cluster.yaml' file. <strong>Remember to change the qos to the one that you have access. Also, change the email that will receive all Slurm messages</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">__default__</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">cluster</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">slurm</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ntasks</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">1</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">n_of_threads</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">1</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">mem</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">4gb</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">qos</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">kirst</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">output</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">logs/snakemake_%j.out</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">error</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">logs/snakemake_%j.err</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">time</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">02:00:00</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">email_user</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">wendellpereira@ufl.edu</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">email_type</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">ALL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>From now one, every time we submit a Slurm job through Snakemake and using this configuration file, it will use these parameters, unless specified otherwise. If we need to change some of the parameters for only one rule, we can do it by adding the parameters that you want to change, as demonstrated below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">mapping</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">n_of_threads</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">6</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">output</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">logs/mapping_%j.out</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">error</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">logs/mapping_%j.err</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">mem</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">10gb</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, if we call snakemake to execute the mapping rule, it will submit a job with all default parameters, except the ones specified to the mapping rule in the "cluster.yaml" file. <strong>No change is necessary in the "Snakefile" or "config.yaml" files</strong>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s commit our modifications in the "cluster.yaml" file. Then, we will learn how to execute Snakemake jobs using a configuration file for Slurm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git commit <span class="tok-s2">&quot;Adds the parameters for the mapping rule&quot;</span> cluster.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_executing_jobs_on_slurm_using_snakemake">Executing jobs on Slurm using Snakemake</h3>
<div class="paragraph">
<p>As shown below, the main difference in the code is the addition of the option <code>--cluster-config</code>. It receives the name of the configuration file that contains the Slurm options. As a consequence, a new variable called <code>cluster</code> will be created, and we can used it in a similar way to what we did to the variable <code>params</code>. See below how <code>{cluster.qos}</code> is used to pass the <code>qos</code> name stored in the "cluster.yaml" file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake -np -j <span class="tok-m">10</span> --cluster-config cluster.yaml --cluster <span class="tok-s2">&quot;sbatch -A {cluster.qos} --mem={cluster.mem} -t {cluster.time} -c {cluster.n_of_threads} -e {cluster.error} -o {cluster.output} --mail-user {cluster.email_user} --mail-type {cluster.email_type}&quot;</span> mapping</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
--cluster-config specifies the location of a file containing the cluster configuration for each rule in the Snakefile.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Remove the option <code>n</code> and execute the above command. Now, it will be submit as a Slurm job.</p>
</div>
<div class="paragraph">
<p>Since all output files were already created, Snakemake will tell us that there is nothing to be done for this rule. We can add the option <code>--force</code> to force the execution of the rule. Also, deleting one or more of the outputs will make Snakemake run the rule, since it will detect that there are missing files that this rule should create.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake --force -p -j <span class="tok-m">10</span> --cluster-config cluster.yaml --cluster <span class="tok-s2">&quot;sbatch -A {cluster.qos} --mem={cluster.mem} -t {cluster.time} -c {cluster.n_of_threads} -e {cluster.error} -o {cluster.output} --mail-user {cluster.email_user} --mail-type {cluster.email_type}&quot;</span> mapping</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you execute the command as show above, your terminal will be occupied until the job is finished. If you don&#8217;t want to wait, it is possible to use <code>nohup</code> and <code>&amp;</code> to execute the command and keep you terminal free: <strong>nohup</strong> <em>snakemake --force -p -j 10 --cluster-config cluster.yaml --cluster "sbatch -A {cluster.qos} --mem={cluster.mem} -t {cluster.time} -c {cluster.n_of_threads} -e {cluster.error} -o {cluster.output} --mail-user {cluster.email_user} --mail-type {cluster.email_type}" mapping</em> <strong>&amp;</strong>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_other_rules_to_the_pipeline_and_executing_some_interesting_options_of_snakemake">Adding other rules to the pipeline and executing some interesting options of Snakemake.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since we already went over the main concepts, we are going to skip the interpretation of the next steps of the pipeline. Using the <a href="https://www.nature.com/articles/nprot.2016.095">Pertea et al, 2016</a> paper and the Snakemake manual, you can understand what the next rules will do. Take it as a practice exercise and try to understand them after the workshop. Maybe, you can even create your rules to finish the results described in the paper.</p>
</div>
<div class="paragraph">
<p>For now, just copy and paste the following lines in the "Snakefile".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">rule</span> <span class="tok-n">sorting_sam</span><span class="tok-p">:</span>
    <span class="tok-nb">input</span><span class="tok-p">:</span>
        <span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;mapping_out/{samples}.sam&quot;</span><span class="tok-p">,</span> <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">])</span>
    <span class="tok-n">params</span><span class="tok-p">:</span>
        <span class="tok-n">threads</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;sorting_sam&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;params&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;threads&quot;</span><span class="tok-p">]</span>
    <span class="tok-n">output</span><span class="tok-p">:</span>
        <span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;mapping_out/{samples}.bam&quot;</span><span class="tok-p">,</span> <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">])</span>
    <span class="tok-n">shell</span><span class="tok-p">:</span>
        <span class="tok-sd">&quot;&quot;&quot;</span>
<span class="tok-sd">        for sample in {input};</span>
<span class="tok-sd">        do</span>

<span class="tok-sd">            name=$(basename $sample \&quot;.sam\&quot;)</span>

<span class="tok-sd">            samtools sort -@ {params.threads} -o mapping_out/${{name}}.bam $sample</span>

<span class="tok-sd">        done</span>
<span class="tok-sd">        &quot;&quot;&quot;</span>

<span class="tok-n">rule</span> <span class="tok-n">assembly</span><span class="tok-p">:</span>
    <span class="tok-nb">input</span><span class="tok-p">:</span>
        <span class="tok-n">gtf</span><span class="tok-o">=</span><span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;{gtf}&quot;</span><span class="tok-p">,</span> <span class="tok-n">gtf</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;assembly&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;params&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;annotation&quot;</span><span class="tok-p">]),</span>
        <span class="tok-n">bam</span><span class="tok-o">=</span><span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;mapping_out/{samples}.bam&quot;</span><span class="tok-p">,</span> <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">])</span>
    <span class="tok-n">params</span><span class="tok-p">:</span>
        <span class="tok-n">threads</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;assembly&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;params&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;threads&quot;</span><span class="tok-p">],</span>
    <span class="tok-n">output</span><span class="tok-p">:</span>
        <span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;gtfs/{samples}.gtf&quot;</span><span class="tok-p">,</span> <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">])</span>
    <span class="tok-n">shell</span><span class="tok-p">:</span>
        <span class="tok-sd">&quot;&quot;&quot;</span>
<span class="tok-sd">        for sample in {input.bam}</span>
<span class="tok-sd">        do</span>

<span class="tok-sd">            prefix_name=$(basename $sample \&quot;_chrX.bam\&quot;)</span>

<span class="tok-sd">            stringtie $sample -G {input.gtf} -p {params.threads} -o gtfs/${{prefix_name}}_chrX.gtf -l ${{prefix_name}}</span>

<span class="tok-sd">        done</span>
<span class="tok-sd">        &quot;&quot;&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following lines in the "config.yaml" file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">sorting_sam</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">params</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">threads</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">4</span>

<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">assembly</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">params</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">threads</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">8</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">annotation</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;chrX_data/genes/chrX.gtf&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following lines in the "cluster.yaml" file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span>    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">sorting_sam</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">n_of_threads</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">4</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">output</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">sorting_sam_%j.out</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">error</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">sorting_sam_%j.err</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">mem</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">10gb</span>

    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">assembly</span><span class="tok-p tok-p-Indicator">:</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">n_of_threads</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">8</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">output</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">assembly_%j.out</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">error</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">assembly_%j.err</span>
        <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">mem</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">10gb</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to commit the changes and synchronizing the files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>git commit -m <span class="tok-s2">&quot;Adds new rules to create the transcripts assembly&quot;</span> Snakefile
git commit -m <span class="tok-s2">&quot;Adds new rules to create the transcripts assembly&quot;</span> config.yaml
git commit -m <span class="tok-s2">&quot;Adds new rules to create the transcripts assembly&quot;</span> cluster.yaml

git push origin master</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_rule_to_execute_the_whole_pipeline">Adding a rule to execute the whole pipeline.</h3>
<div class="paragraph">
<p>As mentioned before, when the name of the rule is not given, Snakemake will try to execute the first rule in the "Snakefile". Therefore, an easy way to execute your pipeline is to create a rule that anticipates all files generated from your output. Or, a rule that anticipates a file which depends of the execution of all rules.</p>
</div>
<div class="paragraph">
<p>In our case, lets use the output of the last rule as the input. We usually call this rule "all", and it has the following structure (Note that no output is necessary for this rule).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">rule</span> <span class="tok-nb">all</span><span class="tok-p">:</span>
    <span class="tok-nb">input</span><span class="tok-p">:</span>
        <span class="tok-c1">#mapping</span>
        <span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;mapping_out/{samples}.sam&quot;</span><span class="tok-p">,</span> <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">]),</span>
        <span class="tok-c1">#sorting_sam</span>
        <span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;mapping_out/{samples}.bam&quot;</span><span class="tok-p">,</span> <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">]),</span>
        <span class="tok-c1">#assembly</span>
        <span class="tok-n">expand</span><span class="tok-p">(</span><span class="tok-s2">&quot;gtfs/{samples}.gtf&quot;</span><span class="tok-p">,</span> <span class="tok-n">samples</span><span class="tok-o">=</span><span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s2">&quot;mapping&quot;</span><span class="tok-p">][</span><span class="tok-s2">&quot;inputs&quot;</span><span class="tok-p">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the rule above in the top of your Snakefile, right after the command that loads the modules.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s execute a dry-run of this rule. Since we already have these outputs, nothing will be done. So, to visualize the list of rules that will be executed by <code>all</code> rule, we can add the option <code>--forceall</code>.</p>
</div>
<div class="paragraph">
<p>Execute the below command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake -np --forceall all</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake -np --forceall</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Snakemake, it is possible to create some reports and summaries of your workflow. They can be very useful for keep tracking of what each rule is generating, execution time and other metrics. Let&#8217;s generate a report of our workflow.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake --report uf_course.html all</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s test how to use the <code>--summary</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>snakemake --summary
snakemake --summary --forcerun assembly</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_final_remarks">Final remarks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Snakemake is still under very active development, with new options been released frequently. Keep updating your knowledge by visiting the manual at: <a href="https://snakemake.readthedocs.io" class="bare">https://snakemake.readthedocs.io</a>. There are also many other sources on internet where you can learn how to apply Snakemake in more advanced ways.</p>
</div>
<div class="paragraph">
<p>I hope this workshop and tutorial was useful to give you good ideas for implementing Snakemake in your routinely activities. Below are some links for more advanced features that can be useful in your workflow.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://snakemake.readthedocs.io/en/stable/tutorial/advanced.html#step-6-temporary-and-protected-files">Temporary and protected files</a></p>
</li>
<li>
<p><a href="https://snakemake.readthedocs.io/en/stable/tutorial/additional_features.html#modularization">Modularization</a></p>
</li>
<li>
<p><a href="https://snakemake.readthedocs.io/en/stable/tutorial/additional_features.html#using-cluster-status">Using cluster-status</a></p>
</li>
<li>
<p><a href="https://snakemake.readthedocs.io/en/stable/executing/cli.html#dealing-with-very-large-workflows">Dealing with very large workflows</a></p>
</li>
<li>
<p><a href="https://snakemake.readthedocs.io/en/stable/snakefiles/remote_files.html#remote-files">Remote files</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-05-15 08:21:45 -0400
</div>
</div>
</body>
</html>